{"version":3,"file":"../checkout-steps-100.min.js","sources":["checkout-steps-100.js"],"sourcesContent":["/**\r\n * Manage checkout steps state.\r\n *\r\n * DEPENDS ON:\r\n * - jQuery // Interact with WooCommerce events\r\n */\r\n(function (root, factory) {\r\n\tif ( typeof define === 'function' && define.amd ) {\r\n\t\tdefine([], factory(root));\r\n\t} else if ( typeof exports === 'object' ) {\r\n\t\tmodule.exports = factory(root);\r\n\t} else {\r\n\t\troot.CheckoutSteps = factory(root);\r\n\t}\r\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\r\n\r\n\t'use strict';\r\n\r\n\tvar $ = jQuery;\r\n\tvar _hasJQuery = ( $ != null );\r\n\r\n\tvar _hasInitialized = false;\r\n\tvar _publicMethods = {};\r\n\tvar _settings = {\r\n\t\tbodyClass: 'has-sc-checkout-steps',\r\n\t\tbodyClassActiveStepPattern: 'sc-checkout-step--active-{ID}',\r\n\r\n\t\twrapperSelector: '.sc-wrapper',\r\n\r\n\t\tprogressBarSelector: '.sc-progress-bar',\r\n\t\tprogressBarCurrentSelector: '.sc-progress-bar__current-step',\r\n\t\tprogressBarItemSelector: '.sc-progress-bar__bar',\r\n\r\n\t\tstepsWrapperSelector: '.sc-checkout-steps',\r\n\t\tstepSelector: '.sc-checkout-step',\r\n\t\tcurrentStepSelector: '[data-step-current]',\r\n\t\tnextStepSelector: '[data-step-current] ~ .sc-checkout-step',\r\n\t\tnextStepButtonSelector: '[data-step-next]',\r\n\t\tfocusableElementsSelector: 'a[role=\"button\"], a[href], button:not([disabled]), input:not([disabled]):not([type=\"hidden\"]), textarea:not([disabled]), select:not([disabled]), details, summary, iframe, object, embed, [contenteditable] [tabindex]:not([tabindex=\"-1\"])',\r\n\r\n\t\tsubstepSelector: '.sc-step__substep',\r\n\t\tsubstepTextContentSelector: '.sc-step__substep-text-content',\r\n\t\tsubstepFieldsSelector: '.sc-step__substep-fields',\r\n\t\tsubstepTextSelector: '.sc-step__substep-text',\r\n\t\tsubstepEditButtonSelector: '[data-step-edit]',\r\n\t\tsubstepSaveButtonSelector: '[data-step-save]',\r\n\r\n\t\texpansibleSectionToggleSelector: '[data-expansible-section-toggle]',\r\n\t\texpansibleSectionExpandAttribute: 'data-expansible-section-expand',\r\n\t\texpansibleSectionCollapseAttribute: 'data-expansible-section-collapse',\r\n\r\n\t\tstepCompleteAttribute: 'data-step-complete',\r\n\t\tstepCurrentAttribute: 'data-step-current',\r\n\t\tstepIndexAttribute: 'data-step-index',\r\n\r\n\t\tisEditingClass: 'is-editing',\r\n\t\tisLoadingClass: 'is-loading',\r\n\t\tisCurrentClass: 'is-current',\r\n\t\tisCompleteClass: 'is-complete',\r\n\t\tstepNextIncompleteClass: 'sc-checkout-step--next-step-incomplete',\r\n\r\n\t\tsubstepEditableStateFieldSelector: '.sc-substep-editable-state[type=\"hidden\"]',\r\n\t\tsubstepEditableStateAttribute: 'data-substep-editable',\r\n\t\tsubstepVisibleStateFieldSelector: '.sc-substep-visible-state[type=\"hidden\"]',\r\n\t\tsubstepVisibleStateAttribute: 'data-substep-visible',\r\n\r\n\t\tinvalidFieldRowSelector: '.woocommerce-invalid .input-text, .woocommerce-invalid select',\r\n\r\n\t\tscrollOffsetSelector: '.sc-checkout-header',\r\n\t\tscrollBehavior: 'smooth',\r\n\t\tscrollOffset: 0,\r\n\t}\r\n\tvar _key = {\r\n\t\tENTER: 'Enter',\r\n\t\tSPACE: ' ',\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * METHODS\r\n\t */\r\n\r\n\r\n\r\n\t/*!\r\n\t* Merge two or more objects together.\r\n\t* (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com\r\n\t* @param   {Boolean}  deep     If true, do a deep (or recursive) merge [optional]\r\n\t* @param   {Object}   objects  The objects to merge together\r\n\t* @returns {Object}            Merged values of defaults and options\r\n\t*/\r\n\tvar extend = function () {\r\n\t\t// Variables\r\n\t\tvar extended = {};\r\n\t\tvar deep = false;\r\n\t\tvar i = 0;\r\n\r\n\t\t// Check if a deep merge\r\n\t\tif ( Object.prototype.toString.call( arguments[0] ) === '[object Boolean]' ) {\r\n\t\t\tdeep = arguments[0];\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\t// Merge the object into the extended object\r\n\t\tvar merge = function (obj) {\r\n\t\t\tfor (var prop in obj) {\r\n\t\t\t\tif (obj.hasOwnProperty(prop)) {\r\n\t\t\t\t\t// If property is an object, merge properties\r\n\t\t\t\t\tif (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n\t\t\t\t\t\textended[prop] = extend(extended[prop], obj[prop]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\textended[prop] = obj[prop];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Loop through each object and conduct a merge\r\n\t\tfor (; i < arguments.length; i++) {\r\n\t\t\tvar obj = arguments[i];\r\n\t\t\tmerge(obj);\r\n\t\t}\r\n\r\n\t\treturn extended;\r\n    };\r\n\r\n\r\n\r\n\t/**\r\n\t * Check if the element is considered visible. Does not consider the CSS property `visibility: hidden;`.\r\n\t */\r\n\t var isVisible = function( element ) {\r\n\t\treturn !!( element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Gets keyboard-focusable elements within a specified element\r\n\t *\r\n\t * @param   HTMLElement  element  The element to search within. Defaults to the `document` root element.\r\n\t *\r\n\t * @return  NodeList              All focusable elements withing the element passed in.\r\n\t */\r\n\t var getFocusableElements = function( element ) {\r\n\t\t// Set element to `document` root if not passed in\r\n\t\tif ( ! element ) { element = document; }\r\n\t\t\r\n\t\t// Get elements that are keyboard-focusable, but might be `disabled`\r\n\t\treturn element.querySelectorAll( _settings.focusableElementsSelector );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Get the offset position of the element recursively adding the offset position of parent elements until the `stopElement` (or the `body` element).\r\n\t *\r\n\t * @param   HTMLElement  element      Element to get the offset position for.\r\n\t * @param   HTMLElement  stopElement  Parent element where to stop adding the offset position to the total offset top position of the element.\r\n\t *\r\n\t * @return  int                       Offset position of the element until the `stopElement` or the `body` element.\r\n\t */\r\n\tvar getOffsetTop = function( element, stopElement ) {\r\n\t\tvar offsetTop = 0;\r\n\t\t\r\n\t\twhile( element ) {\r\n\t\t\t// Reached the stopElement\r\n\t\t\tif ( stopElement && stopElement == element ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\toffsetTop += element.offsetTop;\r\n\t\t\telement = element.offsetParent;\r\n\t\t}\r\n\t\t\r\n\t\treturn offsetTop;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Get all step elements.\r\n\t *\r\n\t * @return  Array  List of step elements.\r\n\t */\r\n\tvar getAllSteps = function() {\r\n\t\tvar stepsWrapper = document.querySelector( _settings.stepsWrapperSelector );\r\n\r\n\t\t// Bail if steps wrapper not found, returns empty `Array`.\r\n\t\tif ( ! stepsWrapper ) { return []; }\r\n\r\n\t\treturn Array.from( stepsWrapper.querySelectorAll( _settings.stepSelector ) );\r\n\t}\r\n\r\n\r\n\r\n\r\n\t/**\r\n\t * Expand the substep fields for edition, and collapse the substep values in text format.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar expandSubstepEdit = function( substepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\r\n\t\tvar substepFieldsElement = substepElement.querySelector( _settings.substepFieldsSelector );\r\n\t\tvar substepTextElement = substepElement.querySelector( _settings.substepTextSelector );\r\n\r\n\t\t// Change expanded/collapsed states for the fields and text blocks\r\n\t\tCollapsibleBlock.expand( substepFieldsElement );\r\n\t\tCollapsibleBlock.collapse( substepTextElement );\r\n\r\n\t\t// Add editing class to the substep element\r\n\t\tsubstepElement.classList.add( _settings.isEditingClass );\r\n\t}\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar collapseSubstepEdit = function( substepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\r\n\t\tvar substepFieldsElement = substepElement.querySelector( _settings.substepFieldsSelector );\r\n\t\tvar substepTextElement = substepElement.querySelector( _settings.substepTextSelector );\r\n\r\n\t\t// Change expanded/collapsed states for the fields and text blocks\r\n\t\tCollapsibleBlock.collapse( substepFieldsElement );\r\n\t\tCollapsibleBlock.expand( substepTextElement );\r\n\r\n\t\t// Remove editing class from the substep element\r\n\t\tsubstepElement.classList.remove( _settings.isEditingClass );\r\n\r\n\t\t// Focus on the substep edit button\r\n\t\tvar editbutton = substepElement.querySelector( _settings.substepEditButtonSelector );\r\n\t\tif ( editbutton ) {\r\n\t\t\teditbutton.focus();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Use the same method that WooCommerce uses to block other parts of the checkout form while updating.\r\n\t * The UI is unblocked by the WooCommerce `checkout.js` script (which is replaced with a modified version but keeps the same behavior)\r\n\t * using the checkout fragment selector, then unblocking after the checkout update is completed.\r\n\t *\r\n\t * @param   HTMLElement  element  Element to block the UI and show the loading indicator.\r\n\t */\r\n\tvar blockUI = function( element ) {\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( element ).block( {\r\n\t\t\t\tmessage: null,\r\n\t\t\t\toverlayCSS: {\r\n\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\topacity: 0.6\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe remove `is-loading` class from fragments after checkout update.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar maybeRemoveFragmentsLoadingClass = function( _event, data ) {\r\n\t\t// Iterate fragments\r\n\t\tif ( data && data.fragments ) {\r\n\t\t\tfor ( var key in data.fragments ) {\r\n\t\t\t\t// Try to get the target fragment element\r\n\t\t\t\tvar framentElement = document.querySelector( key );\r\n\t\t\t\tif ( framentElement ) {\r\n\t\t\t\t\t// Remove `is-loading` class from the fragment element\r\n\t\t\t\t\tframentElement.classList.remove( _settings.isLoadingClass );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\t var maybeSaveSubstep = function( substepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\t\t\r\n\t\t// Maybe validate fields\r\n\t\tif ( window.CheckoutValidation && ! CheckoutValidation.validateAllFields( substepElement ) ) {\r\n\t\t\t// Try to focus the first invalid field\r\n\t\t\tvar firstInvalidField = substepElement.querySelector( _settings.invalidFieldRowSelector );\r\n\t\t\tif ( firstInvalidField ) {\r\n\t\t\t\tfirstInvalidField.focus();\r\n\t\t\t}\r\n\r\n\t\t\t// Bail when substep has invalid fields\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Collapse substep fields and display step in text format\r\n\t\tcollapseSubstepEdit( substepElement );\r\n\r\n\t\t// Update checkout\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t// Get text content element, then block IU\r\n\t\t\tvar contentElement = substepElement.querySelector( _settings.substepTextContentSelector );\r\n\t\t\tblockUI( contentElement );\r\n\r\n\t\t\t// Remove messages prior to updating\r\n\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\r\n\r\n\t\t\t// Trigger update checkout\r\n\t\t\t$( document.body ).trigger( 'update_checkout' );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the progress bar state.\r\n\t */\r\n\tvar updateProgressBar = function() {\r\n\t\t// Get current step\r\n\t\tvar currentStepElement = document.querySelector( _settings.currentStepSelector );\r\n\t\t\r\n\t\t// Bail if no current step was found\r\n\t\tif ( ! currentStepElement ) { return; }\r\n\r\n\t\t// Get index of the current step\r\n\t\tvar currentStepIndex = parseInt( currentStepElement.getAttribute( _settings.stepIndexAttribute ) );\r\n\t\tcurrentStepIndex = isNaN( currentStepIndex ) ? -1 : currentStepIndex;\r\n\r\n\t\t// Get progress bar items\r\n\t\tvar progressBarElement = document.querySelector( _settings.progressBarSelector )\r\n\r\n\t\t// Bail if progress bar element not found\r\n\t\tif ( ! progressBarElement ) { return; }\r\n\r\n\t\tvar progressBarItems = progressBarElement.querySelectorAll( _settings.progressBarItemSelector );\r\n\t\tvar progressBarItemsCount = progressBarItems.length;\r\n\r\n\t\t// Update progress bar items status\r\n\t\tfor ( var i = 0; i < progressBarItems.length; i++ ) {\r\n\t\t\tvar bar = progressBarItems[i];\r\n\t\t\tvar stepIndex = parseInt( bar.getAttribute( _settings.stepIndexAttribute ) );\r\n\t\t\tstepIndex = isNaN( stepIndex ) ? -1 : stepIndex;\r\n\r\n\t\t\t// Update the `current` status for each progress bar item\r\n\t\t\tif ( stepIndex == currentStepIndex ) {\r\n\t\t\t\tbar.classList.add( _settings.isCurrentClass );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbar.classList.remove( _settings.isCurrentClass );\r\n\t\t\t}\r\n\r\n\t\t\t// Update the `complete` status for each progress bar item\r\n\t\t\tif ( stepIndex <= currentStepIndex ) {\r\n\t\t\t\tbar.classList.add( _settings.isCompleteClass );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbar.classList.remove( _settings.isCompleteClass );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Calculate the current step text value\r\n\t\tvar currentStepValue = currentStepIndex + 1;\r\n\t\tcurrentStepValue = currentStepValue <= progressBarItemsCount ? currentStepValue : progressBarItemsCount;\r\n\r\n\t\t// Change value of the current step text indicator\r\n\t\tvar currentStepTextElement = progressBarElement.querySelector( _settings.progressBarCurrentSelector );\r\n\t\tif ( currentStepTextElement ) {\r\n\t\t\tcurrentStepTextElement.innerText = currentStepValue;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Change scroll position after changing steps.\r\n\t *\r\n\t * @param   HTMLElement  stepElement      The element of the step that was just completed.\r\n\t * @param   HTMLElement  nextStepElement  The element of the next step.\r\n\t */\r\n\tvar scrollAfterStepChange = function( stepElement, nextStepElement ) {\r\n\t\tvar stickyElementsOffset = 0;\r\n\r\n\t\t// Maybe add height of the progress bar to scroll position\r\n\t\tvar progressBarElement = document.querySelector( _settings.progressBarSelector );\r\n\t\tif ( progressBarElement ) {\r\n\t\t\tvar height = progressBarElement.getBoundingClientRect().height;\r\n\t\t\tstickyElementsOffset += height;\r\n\t\t}\r\n\r\n\t\t// Maybe add sticky elements height to scroll position\r\n\t\tif ( window.StickyStates ) {\r\n\t\t\tvar maybeStickyElements = document.querySelectorAll( _settings.scrollOffsetSelector );\r\n\t\t\tif ( maybeStickyElements && maybeStickyElements.length > 0 ) {\r\n\t\t\t\tfor ( var i = 0; i < maybeStickyElements.length; i++ ) {\r\n\t\t\t\t\tvar stickyElement = maybeStickyElements[i];\r\n\t\t\t\t\tif ( StickyStates.isStickyPosition( stickyElement ) ) {\r\n\t\t\t\t\t\tvar height = stickyElement.getBoundingClientRect().height;\r\n\t\t\t\t\t\tstickyElementsOffset += height;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Scroll to the top of the collapsed step\r\n\t\tvar stepElementOffset = getOffsetTop( stepElement ) + ( _settings.scrollOffset * -1 ) + ( stickyElementsOffset * -1 );\r\n\t\trequestAnimationFrame( function() {\r\n\t\t\twindow.scrollTo( {\r\n\t\t\t\ttop: stepElementOffset,\r\n\t\t\t\tbehavior: _settings.scrollBehavior,\r\n\t\t\t} );\r\n\t\t} );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar maybeProceedNextStep = function( stepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! stepElement ) { return; }\r\n\r\n\t\t// Maybe validate fields\r\n\t\tif ( window.CheckoutValidation && ! CheckoutValidation.validateAllFields( stepElement ) ) {\r\n\t\t\t// Try to focus the first invalid field\r\n\t\t\tvar firstInvalidField = stepElement.querySelector( _settings.invalidFieldRowSelector );\r\n\t\t\tif ( firstInvalidField ) {\r\n\t\t\t\tfirstInvalidField.focus();\r\n\t\t\t}\r\n\r\n\t\t\t// Bail when any substep has invalid fields\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Set current step as complete\r\n\t\tstepElement.setAttribute( _settings.stepCompleteAttribute, '' );\r\n\r\n\t\t// Collapse substeps fields and display step in text format\r\n\t\tvar substepElements = stepElement.querySelectorAll( _settings.substepSelector );\r\n\t\tfor ( var i = 0; i < substepElements.length; i++ ) {\r\n\t\t\tvar substepElement = substepElements[i];\r\n\r\n\t\t\t// Get text content element, then block IU\r\n\t\t\tvar contentElement = substepElement.querySelector( _settings.substepTextContentSelector );\r\n\t\t\tif ( contentElement ) {\r\n\t\t\t\tcontentElement.classList.add( _settings.isLoadingClass );\r\n\t\t\t\tblockUI( contentElement );\r\n\t\t\t}\r\n\r\n\t\t\t// Collapse substep\r\n\t\t\tcollapseSubstepEdit( substepElement );\r\n\t\t}\r\n\r\n\t\t// Get next step, and set it as current\r\n\t\tvar nextStepElement = stepElement.parentElement.querySelector( _settings.nextStepSelector );\r\n\t\tnextStepElement.setAttribute( _settings.stepCurrentAttribute, '' );\r\n\r\n\t\t// Unset `current` from the step that is closing\r\n\t\t// (needs to run after setting the next step as the current one)\r\n\t\tstepElement.removeAttribute( _settings.stepCurrentAttribute );\r\n\r\n\t\t// Remove `next-step-incomplete` class from previous steps\r\n\t\tvar allSteps = getAllSteps();\r\n\t\tvar stepIndex = allSteps.indexOf( stepElement );\r\n\t\tfor ( var i = 0; i < allSteps.length; i++ ) {\r\n\t\t\tif ( i < stepIndex ) {\r\n\t\t\t\tvar step = allSteps[i];\r\n\t\t\t\tstep.classList.remove( _settings.stepNextIncompleteClass );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Update progress bar\r\n\t\tupdateProgressBar();\r\n\r\n\t\t// Change scroll position after moving to next step\r\n\t\tscrollAfterStepChange( stepElement, nextStepElement );\r\n\r\n\t\t// Maybe set focusElement to the first focusable element that is visible\r\n\t\tvar focusElement = null;\r\n\t\tvar focusableElements = Array.from( getFocusableElements( nextStepElement ) );\r\n\t\tfor ( var i = 0; i < focusableElements.length; i++ ) {\r\n\t\t\tvar focusableElement = focusableElements[i];\r\n\t\t\tif ( isVisible( focusableElement ) ) {\r\n\t\t\t\tfocusElement = focusableElement;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set focus\r\n\t\tif ( focusElement ) {\r\n\t\t\tfocusElement.focus();\r\n\t\t}\r\n\r\n\t\t// Trigger update checkout\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( document.body ).trigger( 'update_checkout' );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe change visibility status of the shipping address edit buttons when shipping method is `local_pickup`.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar maybeChangeSubstepState = function( _event, data ) {\r\n\t\tvar substepElements = document.querySelectorAll( _settings.substepSelector );\r\n\t\tfor ( var i = 0; i < substepElements.length; i++ ) {\r\n\t\t\tvar substepElement = substepElements[i];\r\n\t\t\t\r\n\t\t\t// Handle substep editable state\r\n\t\t\tvar editableHiddenField = substepElement.querySelector( _settings.substepEditableStateFieldSelector );\r\n\t\t\tif ( editableHiddenField && 'no' === editableHiddenField.value ) {\r\n\t\t\t\tsubstepElement.setAttribute( _settings.substepEditableStateAttribute, editableHiddenField.value );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsubstepElement.removeAttribute( _settings.substepEditableStateAttribute );\r\n\t\t\t}\r\n\r\n\t\t\t// Handle substep visibility state\r\n\t\t\tvar visibilityHiddenField = substepElement.querySelector( _settings.substepVisibleStateFieldSelector );\r\n\t\t\tif ( visibilityHiddenField && 'no' === visibilityHiddenField.value ) {\r\n\t\t\t\tsubstepElement.setAttribute( _settings.substepVisibleStateAttribute, visibilityHiddenField.value );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsubstepElement.removeAttribute( _settings.substepVisibleStateAttribute );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle document clicks and route to the appropriate function.\r\n\t */\r\n\tvar handleClick = function( e ) {\r\n\t\t// NEXT STEP\r\n\t\tif ( e.target.closest( _settings.nextStepButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar step = e.target.closest( _settings.stepSelector );\r\n\t\t\tmaybeProceedNextStep( step );\r\n\t\t}\r\n\t\t// EDIT SUBSTEP\r\n\t\telse if ( e.target.closest( _settings.substepEditButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar substepElement = e.target.closest( _settings.substepSelector );\r\n\t\t\texpandSubstepEdit( substepElement );\r\n\t\t}\r\n\t\t// SAVE SUBSTEP\r\n\t\telse if ( e.target.closest( _settings.substepSaveButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar substepElement = e.target.closest( _settings.substepSelector );\r\n\t\t\tmaybeSaveSubstep( substepElement );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle keypress event.\r\n\t */\r\n\t var handleKeyDown = function( e ) {\r\n\t\t// Should do nothing if the default action has been cancelled\r\n\t\tif ( e.defaultPrevented ) { return; }\r\n\r\n\t\t// ENTER or SPACE on handler element\r\n\t\tif ( ( e.key == _key.ENTER || e.key == _key.SPACE ) && ( e.target.closest( _settings.substepEditButtonSelector ) || e.target.closest( _settings.substepSaveButtonSelector ) ) ) {\r\n\t\t\t// Similate click\r\n\t\t\thandleClick( e );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Finish to initialize component and set related handlers.\r\n\t */\r\n\t var finishInit = function() {\r\n\t\t// Add event listeners\r\n\t\twindow.addEventListener( 'click', handleClick );\r\n\t\tdocument.addEventListener( 'keydown', handleKeyDown, true );\r\n\r\n\t\t// Add jQuery event listeners\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( document.body ).on( 'updated_checkout', maybeChangeSubstepState );\r\n\t\t\t$( document.body ).on( 'updated_checkout', maybeRemoveFragmentsLoadingClass );\r\n\t\t}\r\n\r\n\t\t// Add init class\r\n\t\tdocument.body.classList.add( _settings.bodyClass );\r\n\r\n\t\t_hasInitialized = true;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Initialize component and set related handlers.\r\n\t */\r\n\t_publicMethods.init = function( options ) {\r\n\t\tif ( _hasInitialized ) return;\r\n\r\n\t\t// Merge settings\r\n\t\t_settings = extend( _settings, options );\r\n\r\n\t\t// Finish initialization, maybe load dependencies first\r\n\t\tif ( window.CollapsibleBlock ) {\r\n\t\t\tfinishInit();\r\n\t\t}\r\n\t\telse if( window.RequireBundle ) {\r\n\t\t\tRequireBundle.require( [ 'collapsible-block' ], function() { finishInit(); } );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t//\r\n\t// Public APIs\r\n\t//\r\n\treturn _publicMethods;\r\n\r\n});\r\n"],"names":["root","factory","define","amd","exports","module","CheckoutSteps","global","this","window","extend","extended","deep","i","Object","prototype","toString","call","arguments","length","obj","prop","hasOwnProperty","merge","collapseSubstepEdit","substepElement","substepFieldsElement","substepTextElement","querySelector","_settings","substepFieldsSelector","substepTextSelector","CollapsibleBlock","collapse","expand","classList","remove","isEditingClass","editbutton","substepEditButtonSelector","focus","blockUI","element","_hasJQuery","$","block","message","overlayCSS","background","opacity","maybeRemoveFragmentsLoadingClass","_event","data","fragments","key","framentElement","document","isLoadingClass","maybeChangeSubstepState","substepElements","querySelectorAll","substepSelector","editableHiddenField","substepEditableStateFieldSelector","value","setAttribute","substepEditableStateAttribute","removeAttribute","visibilityHiddenField","substepVisibleStateFieldSelector","substepVisibleStateAttribute","handleKeyDown","e","defaultPrevented","_key","ENTER","SPACE","target","closest","substepSaveButtonSelector","handleClick","finishInit","addEventListener","body","on","add","bodyClass","_hasInitialized","jQuery","_publicMethods","bodyClassActiveStepPattern","wrapperSelector","progressBarSelector","progressBarCurrentSelector","progressBarItemSelector","stepsWrapperSelector","stepSelector","currentStepSelector","nextStepSelector","nextStepButtonSelector","focusableElementsSelector","substepTextContentSelector","expansibleSectionToggleSelector","expansibleSectionExpandAttribute","expansibleSectionCollapseAttribute","stepCompleteAttribute","stepCurrentAttribute","stepIndexAttribute","isCurrentClass","isCompleteClass","stepNextIncompleteClass","invalidFieldRowSelector","scrollOffsetSelector","scrollBehavior","scrollOffset","expandSubstepEdit","maybeSaveSubstep","contentElement","CheckoutValidation","validateAllFields","trigger","firstInvalidField","maybeProceedNextStep","stepElement","nextStepElement","parentElement","stepsWrapper","allSteps","Array","from","stepIndex","indexOf","currentStepElement","currentStepIndex","parseInt","getAttribute","isNaN","progressBarElement","progressBarItems","progressBarItemsCount","bar","currentStepValue","currentStepTextElement","innerText","updateProgressBar","stickyElementsOffset","getBoundingClientRect","height","StickyStates","maybeStickyElements","stickyElement","isStickyPosition","stepElementOffset","stopElement","offsetTop","offsetParent","getOffsetTop","requestAnimationFrame","scrollTo","top","behavior","scrollAfterStepChange","focusElement","focusableElements","focusableElement","offsetWidth","offsetHeight","getClientRects","step","preventDefault","init","options","RequireBundle","require"],"mappings":"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"}